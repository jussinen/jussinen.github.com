<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>.lj/random thoughts</title>
        <meta name="description" content="posts and random mutterings from john folley, aka jussinen">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/shCoreRDark.css">
		<link rel="stylesheet" href="/css/main.css">
        
        <script src="/js/libs/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        
        <header class="site-header">
            <div class="heading">
                <h1><a href="/">.lj</a></h1><h2>random thoughts</h2>
            </div>
        </header>

        <div class="container">
            <div class="row">
                <section class="span9">
                    <article class="post">
                        <header class="article-heading">
                            <h1>
                                <a href="#">Crafted.Volva: Basic authentication module for IIS7</a>
                            </h1>
                            <span class="meta-information">by John Folley on 12th of Feb 2013</span>
                        </header>
                        <h2>Why a basic authentication module for IIS7?</h2>
                        <p>In IIS6, ASP.Net is used more as a plugin to IIS, where requests are passed to the ASP.Net process after going through the IIS process. </p>
                        <p>In II7, Microsoft introduced the concept of "integrated pipeline" and "Classic". Whereas Classic acts in the same way as IIS6, using "integrated pipeline" means that requests are handled by ASP.Net directly. </p>
                        <p>In .Net, different authentication methods use the standard way of setting an authenticated user to the Page using the Principal. This then affects authentication, permissions rules set in web.config. </p>
                        <p>In IIS6, it is possible to use IIS authentication (basic) to secure a site behind a password, which is useful for test sites. In IIS7 "integrated pipeline", ASP.Net handles all the authentication methods. </p>
                        <p>This means that you can only set one method of authentication as there can be only one Principal set to the Page. So setting up Basic authentication will cause ASP.Net to consider the user as signed in as with Forms Authentication, which means that secured areas of the website no longer get redirected to a login page using Forms Authentication. </p>
                        <h2>Usage</h2>
                        <p>To use the module, simply include the DLLs in the project and modify your web.config in three places: </p>
                        <p>In configSections, add a new config section for Crafted.Volva: </p>
                        <pre class="brush: xml">
&lt;configSections>
    &lt;section name="Crafted.Volva" type="Crafted.Volva.VolvaConfig" />
&lt;/configSections>    </pre>
                        <p>In system.webServer (only as the issue only affects IIS7 in "integrated pipeline":</p>
                        <pre class="brush: xml">
&lt;system.webServer>
    &lt;modules runAllManagedModulesForAllRequests="true">
        &lt;remove name="Crafted.Volva"/>
        &lt;add name="Crafted.Volva" type="Crafted.Volva.BasicAuthentication" />
    &lt;/modules>
&lt;/system.webServer>  </pre>
                        <p>And then the configuration settings:</p>
                        <pre class="brush: xml">
&lt;Crafted.Volva BasicAuthenticationIsEnabled="true">
    &lt;locations>
        &lt;path match="*" />
    &lt;/locations>
    &lt;users>
        &lt;user username="sampleUser" password="samplePassword" />
    &lt;/users>
&lt;/Crafted.Volva>     </pre>
                        <h2>Settings</h2>
                        <p>
                            <code>&lt;locations></code> refer to which parts of the site should be secured by Crafted.Volva. The paths include either "*" (for all requests) or a regex expression passed against the Request.RawUrl. 
                        </p>
                        <p>
                            <code>&lt;users></code> refer to additional users you want to set. Note that users that have a server login can log in with these credentials. 
                        </p>
                        <h2>Removal</h2>
                        <p>Removal is easy. You can do this in multiple ways:
                            <br>
                            1. Remove all web.config settings and the DLL
                            <br>
                            2. Remove all web.config settings only and keep the DLL
                            <br>
                            3. Remove the configuration section in web.config
                            <br>
                            4. Remove the HTTP Module line in web.config
                            <br>
                            5. Set BasicAuthenticationIsEnabled="false"  
                        </p>
                        <p>The last two ways of removing are advised as this allows you to use the module whenever you need by simply re-adding the HTTP module or changing the config setting.  </p>
                        <span class="meta-information">Tags: <a href="#">web dev</a></span>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                            var disqus_shortname = 'jussinen'; 

                            (function() {
                                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                            })();
                        </script>
                        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
                    </article>
                </section>
                <aside class="span3">
                    <nav class="pod">
                        <h4 class="list-heading">menu</h4>
                        <ul class="list">
                            <li><a href="/">home</a></li>
                            <li><a href="/blog">blog</a></li>
                            <li><a href="/about">about me</a></li>
                            <li><a href="/projects">projects</a></li>
                        </ul>
                    </nav>
                    <div class="pod">
                        <h4 class="list-heading">tags</h4>
                        <ul class="list">
                            <li><a href="/tags/web">web dev</a></li>
                            <li><a href="/tags/lds">lds stuff</a></li>
                            <li><a href="/tags/random">ramblings</a></li>
                        </ul>
                    </div>
                    <div class="pod">
                        <h4 class="list-heading">contact</h4>
                        <dl class="list">
                            <dt>twitter</dt>
                            <dd><a href="https://twitter.com/jussinen">@jussinen</a></dd>
                            <dt>github</dt>
                            <dd><a href="https://github.com/jussinen">@jussinen</a></dd>
                        </dl>
                    </div>
                </aside>
            </div>

        </div> <!-- /container -->
        
        
        <footer>
            <p class="copyright">&copy; John Folley 2013</p>
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/libs/jquery-1.9.1.min.js"><\/script>')</script>

        <script src="/js/libs/bootstrap.min.js"></script>
        
        <script type="text/javascript" src="/js/libs/syntax/shCore.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushBash.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushCSharp.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushCss.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushDiff.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushJScript.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushPlain.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushPowerShell.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushSass.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushSql.js"></script>
        <script type="text/javascript" src="/js/libs/syntax/shBrushXml.js"></script>

        <script src="js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
